{% extends 'layout/base.html' %}
{% load desparchado_tags %}

{% block title %}{{ event.title }}{% endblock %}

{% block meta %}
  <meta property="og:title" content="{{ event.title }}">
  <meta property="og:description" content="{{ event.place }}">
  <meta property="og:image" content="http://{{ request.get_host }}{{ event.get_image_url }}">

  <meta name="twitter:title" content="{{ event.title }}">
  <meta name="twitter:description" content="{{ event.place.name }}">
{% endblock %}

{% block google-structured-markup %}
<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Event",
  "name" : "{{ event.title }}",
  "startDate" : "{{ event.event_date|date:'c' }}",
  "location" : {
    "@type" : "Place",
    "name" : "{{ event.place.name }}",
    "address" : "{{ event.place.description }}"
  },
  "image" : "https://{{ request.get_host }}{{ event.get_image_url }}"
}
</script>
{% endblock %}

{% block content %}
<section id="event-detail" class="container">
<div class="row">
  <div class="col-md-8">
    <div class="event-heading">
      <ul class="event-tags">
        <li class="tags-item">{{ event.get_event_type_display }}</li>
        <li class="tags-item">{{ event.get_topic_display }}</li>
      </ul>
      <h1 class="event-title">{{ event.title }}</h1>
      <div class="event-info">
        <div class="event-date">
          {{ event.event_date|date:'l, j M Y' }},
          {{ event.event_date|date:'h:i a' }}
        {% if event.event_end_date %}
          {% ifequal event.event_date|date:"j-M-Y" event.event_end_date|date:"j-M-Y" %}
            &ndash;
            {{ event.event_end_date|date:'h:i a' }}
          {% else %}
            &ndash;
            {{ event.event_end_date|date:'l, j M Y' }},
            {{ event.event_end_date|date:'h:i a' }}
          {% endifequal %}
        {% endif %}
        </div>
        <div class="event-place">
          <a class="link" href="{% url 'places:place_detail' event.place_id %}">
            <i class="fas fa-map-marker-alt"></i>
            {{ event.place }}
          </a>
        </div>
      </div>
    </div>

    <div class="event-image">
      <div class="event-img-wrap">
        <img class="image img-responsive" alt="{{ event.title }}" src="{{ event.get_image_url }}">
        <div class="city-name-label">
          <a href="{{ event.place.city.get_absolute_url }}">{{ event.place.city.name }}</a>
        </div>
        {% if event.price %}<div class="ticket-price-label">{{ event.get_price_display }}</div>{% endif %}
      </div>
    </div>

  {% if user|user_can_edit_event:event %}
    <div class="event-edit text-center">
      <a href="{% url 'events:event_update' event.pk %}" class="btn btn-sm btn-default">EDITAR EVENTO</a>
    </div>
  {% endif %}

    <div class="event-description" itemprop="description">
      {{ event.description|markdown }}
    </div>

    <p>
      <small>
      En Desparchado.co sólo brindamos un espacio en Internet para hacer difusión
      de eventos culturales, generalmente publicados en nuestro sitio por voluntarios.
      El registro de asistentes, tiquetes, boletería, inscripciones son manejados
      por los organizadores de cada evento, con quienes, por lo general,
      no tenemos contacto directo.
      Le recomendamos contactar al organizador del evento
      o al sitio donde el evento tendrá lugar
      para solicitar información sobre la inscripción
      en el caso de que sea necesario.
      </small>
    </p>

    {% if event.event_source_url %}
    <div class="event-source">
      <i class="fa fa-globe"></i>
      <span>Página del evento:</span>
      <a href="{{ event.event_source_url }}" target="_blank">{{ event.event_source_url|truncatechars:50 }}</a>
    </div>
    {% endif %}

    <p>¿Planea ir al evento? Cuéntele a sus amigos:</p>

    <div class="addthis_inline_share_toolbox"></div>

  {% if event.image_source_url %}
    <div class="image-source">
      Imagen:
      <a href="{{ event.image_source_url }}" target="_blank">{{ event.image_source_url|shorten_url }}</a>
    </div>
  {% endif %}

    <div class="event-place">
      <h3 class="secondary-title">Lugar del evento</h3>

      {% if event.place.image %}
        <img class="place-image" src="{{ event.place.get_image_url }}" alt="{{ event.place.name }}" />
      {% endif %}

      <h4><a href="{{ event.place.get_absolute_url }}">{{ event.place.name }}</a></h4>

      <div><b>Dirección:</b> {{ event.place.description }}</div>

      <div><a href="{{ event.place.get_absolute_url }}">Ver otros eventos en este sitio</a></div>

      <div class="clearfix"></div>

      {% include 'includes/_map.html' with title=event.place subtitle=event.event_date latitude=event.get_latitude_str longitude=event.get_longitude_str css_class='event-map' %}
    </div>

  </div>

  <div class="col-md-4">

  {% if event.speakers.exists %}

    <h3 class="secondary-title">Presentadores</h3>

    {% for speaker in event.speakers.all %}

      <div class="event-speaker">
        {% if speaker.image %}
        <div class="text-center">
          <a href="{{ speaker.get_absolute_url }}">
            <div class="image" style="background-image: url('{{ speaker.get_image_url }}');"
               title="{{ speaker.name }}"></div>
          </a>
        </div>
        {% endif %}
        <h4><a href="{{ speaker.get_absolute_url }}">{{ speaker.name }}</a></h4>
        <div>
          {{ speaker.description|markdown|truncatewords_html:50 }}
        </div>
      </div>
    {% endfor %}

  {% endif %}

  {% if event.organizer %}

    <h3 class="secondary-title">Organizador</h3>

    <div class="event-organizer">

      {% if event.organizer.image %}
      <div class="text-center">
        <a href="{{ event.organizer.get_absolute_url }}">
          <img class="image img-responsive" src="{{ event.organizer.get_image_url }}" alt="{{ event.organizer.name }}">
        </a>
      </div>
      {% endif %}
      <h4 class="tex-center"><a href="{{ event.organizer.get_absolute_url }}">{{ event.organizer.name }}</a></h4>

      <div>
        {{ event.organizer.description|markdown|truncatewords_html:50 }}
      </div>
    </div>

  {% endif %}

  {% for special in event.specials.all %}
    <br>

    <section class="container boxes-grid">
      <div class="row row-eq-height">
        <div class="desparchado-box col-sm-4">
          <a class="link" href="{{ special.get_absolute_url }}">
            <div class="box-img-wrap">
              <img class="image img-responsive"
                   src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAACHAQMAAADdtyVCAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAANQTFRF////p8QbyAAAAAF0Uk5TAEDm2GYAAAAbSURBVBgZ7cExAQAAAMIg+6deCU9gAAAAAPAWEnUAAUFphIwAAAAASUVORK5CYII="
                   alt="{{ special.title }}" style="background-image: url({{ special.get_image_url }});">
            </div>
          </a>
          <div class="box-inner">
            <div class="box-subtitle">{{ special.subtitle }}</div>
            <a href="{{ special.get_absolute_url }}"><h2 class="box-title">{{ special.title }}</h2></a>
          </div>
        </div>
      </div>
    </section> <!--/.boxes-grid-->
  {% endfor %}

  {% if books %}
    <h3 class="secondary-title">Libro{{ books|length|pluralize }}</h3>

    <div class="related-books">
      {% for book in books %}
        {% include 'books/_book.html' %}
      {% endfor %}
    </div>
  {% endif %}

  <br>

  <div class="fb-page" data-href="https://www.facebook.com/DesparchadoCo/" data-small-header="true" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="false"><blockquote cite="https://www.facebook.com/DesparchadoCo/" class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/DesparchadoCo/">Desparchado</a></blockquote></div>

  </div>
</div>

<div>
  {% if press_articles %}
    <h4>Artículos de prensa</h4>
    {% include 'news/_press_articles.html' with press_articles=press_articles %}
  {% endif %}

  {% if related_events.exists %}
    <h4>Eventos relacionados</h4>
    {% include 'events/_events_grid.html' with events=related_events.all %}
  {% endif %}

  {% include 'includes/_disqus_comments.html' with page_id="event-"|add:event.id %}
</div>

</section><!--/#event-detail-->
{% endblock content %}
